# MoveIt - Интерактивные кнопки уведомлений

## Обзор реализации

В приложение MoveIt были добавлены три интерактивные кнопки для уведомлений о смене фаз:

1. **Перейти к новому состоянию** - немедленно переключает на следующую фазу
2. **Продолжить текущее состояние** - перезапускает таймер текущей фазы
3. **Отложить уведомление на n минут** - откладывает переход (настраиваемое время)

## Технические детали

### Архитектура

- **NotificationService**: Теперь наследует от `NSObject` и реализует `UNUserNotificationCenterDelegate`
- **Notification Categories**: Используется категория `moveit.phase` с тремя действиями
- **Thread Safety**: Все обработчики делегата выполняются в главной очереди

### Идентификаторы действий

```swift
static let categoryIdentifier = "moveit.phase"
static let transitionActionId = "moveit.transition"
static let continueActionId = "moveit.continue"
static let snoozeActionId = "moveit.snooze"
```

### Обработка нажатий кнопок

Метод `userNotificationCenter(_:didReceive:withCompletionHandler:)` обрабатывает три действия:

- **moveit.transition**: Вызывает `phaseManager?.transitionToNextPhase()`
- **moveit.continue**: Вызывает `phaseManager?.restartCurrentPhase()`
- **moveit.snooze**: Откладывает уведомление на заданное время

## Настройки

### Время откладывания

В настройках приложения добавлен слайдер для выбора времени откладывания:
- Минимум: 1 минута
- Максимум: 30 минут
- По умолчанию: 5 минут

## Использование

1. Когда появляется уведомление о смене фазы, наведите курсор на него
2. Нажмите кнопку "Options" (Параметры) в уведомлении
3. Выберите одно из трех действий

### Поведение кнопок

- **Перейти к новому состоянию**: Приложение сразу переключится на следующую фазу (сидение → стояние или наоборот)
- **Продолжить текущее состояние**: Таймер текущей фазы начнется заново
- **Отложить уведомление**: Уведомление появится снова через заданное время

## Тестирование

Для тестирования кнопок используйте скрипт `test_notifications.swift`:

```bash
chmod +x test_notifications.swift
./test_notifications.swift
```

## Совместимость

- macOS 14.0+
- Требует разрешения на отправку уведомлений
- Поддерживает как баннерные, так и оповещающие стили уведомлений

## Примечания

- Кнопки отображаются только при наведении на уведомление
- Действие "Перейти к новому состоянию" открывает приложение (опция `.foreground`)
- Другие действия выполняются в фоне без открытия приложения