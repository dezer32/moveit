# Процесс создания macOS приложения MoveIt в Xcode

## Урок: Как правильно создавать Xcode проект программно

### Проблема
При создании Xcode проекта через программную генерацию `.pbxproj` файла, я столкнулся с ошибкой:
```
The project 'MoveIt' is damaged and cannot be opened.
Exception: -[XCBuildConfiguration group]: unrecognized selector sent to instance
```

### Причина ошибки
Первоначальный `.pbxproj` файл содержал некорректные ссылки и структуру. Xcode проекты имеют сложный формат с множеством взаимосвязанных UUID и секций.

### Правильный подход к созданию Xcode проекта

#### 1. Структура минимального рабочего проекта
```
MoveIt.xcodeproj/
└── project.pbxproj
MoveIt/
├── MoveItApp.swift
├── ContentView.swift
├── Assets.xcassets/
├── Preview Content/
└── MoveIt.entitlements
```

#### 2. Ключевые секции в project.pbxproj
- **PBXBuildFile**: Список файлов для компиляции
- **PBXFileReference**: Определения всех файлов проекта
- **PBXGroup**: Структура папок в проекте
- **PBXNativeTarget**: Настройки целей сборки
- **PBXProject**: Главные настройки проекта
- **XCBuildConfiguration**: Конфигурации сборки (Debug/Release)

#### 3. Критические моменты
- Все UUID должны быть уникальными и корректно связанными
- Секция `rootObject` должна указывать на правильный PBXProject
- Build phases должны быть правильно настроены (Sources, Resources, Frameworks)

### Решение для сложных проектов

#### Подход 1: Упрощенный проект + полный код
1. Создать минимальный рабочий `.pbxproj`
2. Предоставить полную реализацию в одном файле (`MoveItComplete.swift`)
3. Дать инструкции по разделению кода на модули

#### Подход 2: Использование инструментов
- `xcodegen` - генератор проектов из YAML
- `swift package init` - создание Swift Package
- Xcode CLI tools для создания проекта

### Флоу создания MoveIt приложения

1. **Планирование архитектуры**
   - Определил основные компоненты: Timer, Notifications, Menu Bar, Settings
   - Выбрал паттерн MVVM для организации кода
   - Использовал SwiftUI и Combine для реактивности

2. **Создание моделей данных**
   - `Phase` enum - состояния (sit/stand/paused/inactive)
   - `Schedule` struct - расписание и настройки
   - Core Data для персистентности сессий

3. **Реализация бизнес-логики**
   - `ScheduleEngine` - управление таймером и переходами
   - `NotificationManager` - отправка уведомлений
   - `SessionStore` - сохранение истории сессий

4. **Построение UI**
   - `MenuBarView` - основной интерфейс в меню баре
   - `ContentView` - окно приложения
   - `SettingsView` - настройки расписания

5. **Интеграция компонентов**
   - `TimerViewModel` - координация всех частей
   - Биндинги между UI и бизнес-логикой
   - Обработка системных событий (sleep/wake)

### Полезные команды

```bash
# Проверка валидности проекта
xcodebuild -list -project MoveIt.xcodeproj

# Сборка проекта из командной строки
xcodebuild -project MoveIt.xcodeproj -scheme MoveIt build

# Создание Swift package (альтернатива)
swift package init --type executable
```

### Выводы

1. **Не генерировать сложные `.pbxproj` вручную** - слишком много точек отказа
2. **Использовать минимальные шаблоны** - проще отладить
3. **Предоставлять полный код** - пользователь может сам организовать файлы
4. **Документировать процесс сборки** - четкие инструкции критичны

### Рекомендации на будущее

При создании Xcode проектов:
1. Начинать с минимального рабочего шаблона
2. Постепенно добавлять файлы через Xcode UI
3. Использовать `xcodegen` для программной генерации
4. Или создавать Swift Package вместо Xcode проекта

Этот подход гарантирует работающий проект и избегает сложностей с форматом `.pbxproj`.